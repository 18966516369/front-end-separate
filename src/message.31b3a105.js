function afterTran(){function a(a){a>10&&$(".page-inbox").is(":hidden")&&$(".page-inbox").show().pagination({items:a,itemsOnPage:10,cssStyle:"light-theme",onPageClick:function(a){b(a)}}),10>=a&&$(".page-inbox").hide()}function b(b){$.get("/message/listInbox",{per_page:10,page:b?b:1},function(b){resultHandle(b,function(){if(b.obj.content&&b.obj.content.length){var d=doT.template($("#message-tmpl").html())(b.obj.content);$(".m-item.active .mcj_g").html(d).i18n(),$(".m-item.active .mcj_l").show()}else $(".m-item.active .mcj_g").html('<h3 class="message-no" data-i18n="msg.no"></h3>').i18n(),$(".m-item.active .mcj_l").hide();a(b.obj.total),c(b.obj.unRead)})})}function c(a){void 0!=a?0==a?$("#receive-newcounts,#r-read").text(""):$("#receive-newcounts,#r-read").text(a):$("#receive-newcounts,#r-read").text(function(){return Number($(this).text())-1})}function d(a){$.get("/message/listOutbox",{per_page:10,page:a?a:1},function(a){resultHandle(a,function(){if(a.obj.content&&a.obj.content.length){for(var b=a.obj.content,c=0;c<b.length;c++)b[c].status="";var d=doT.template($("#message-tmpl").html())(b);$(".m-item.active .mcj_g").html(d).i18n(),$(".m-item.active .mcj_l").show()}else $(".m-item.active .mcj_g").html('<h3 class="message-no" data-i18n="msg.no"></h3>').i18n(),$(".m-item.active .mcj_l").hide();e(a.obj.total)})})}function e(a){a>10&&$(".page-outbox").is(":hidden")&&$(".page-outbox").show().pagination({items:a,itemsOnPage:10,cssStyle:"light-theme",onPageClick:function(a){b(a)}}),10>=a&&$(".page-outbox").hide()}b(),$(".mcj_c li").click(function(){$(this).addClass("active").siblings().removeClass("active"),$(".m-item").eq($(this).index()).addClass("active").siblings().removeClass("active")}),$(document).on("click","#tab1",function(){$(".m-item.active .mcj_g li").length||d()});var f;$(document).on("click",".mcj_j",function(){f=$(this).parents("li"),$(this).parents("li").hasClass("unread")&&($(this).parents("li").removeClass("unread"),$.post("/message/saveCrmMessage",{custMessageId:$(this).data("id")},function(a){resultHandle(a),c()}));var a=$(this).children(),b=doT.template($("#message-detail").html())({subject:a.data("subject"),time:a.data("time"),content:a.data("content")});return $(".msgpop-main").html(b).i18n(),$("body").css("overflow-y","hidden"),$("#fix-messagepopup").css("overflow-y","scroll").fadeIn(),!1}),$(document).on("click",".m-detail",function(){return $(this).parents("li").find(".mcj_j").trigger("click"),!1}),$(document).on("click","#btn-close,#message-box .close",function(){return $(".msgpop-main").html(""),$("body").css("overflow-y","auto"),$("#fix-messagepopup").css("overflow-y","hidden").fadeOut(),!1}),$(document).on("click",".all",function(){$(this).is(":checked")?$(".m-item.active .mcj_g").find(":checkbox").prop("checked","checked"):$(".m-item.active .mcj_g").find(":checkbox").removeAttr("checked")}),$(document).on("click","#del-receivemsg",function(){var a=$(".m-item.active .mcj_g").find(":checkbox:checked");if(!a.length)return dialog.info($.t("valid.msg.1")),!1;var b=[];a.each(function(){b.push($(this).val())}),$.post("/message/deleteCrms",{custMessageId:b.join(",")},function(b){resultHandle(b,function(){a.parents("li").slideUp(function(){$(this).remove()})})})}),$(document).on("click",".delete-inner",function(){$(this).parents("#fix-messagepopup").find(".close").trigger("click"),$.post("/message/deleteCrms",{custMessageId:f.find(".mcj_j").data("id")},function(a){resultHandle(a,function(){f.slideUp(function(){$(this).remove()})})})}),$(document).on("click","#btn-send",function(){var a=$("#title").val(),b=$("#message").val();return a.length&&b.length?a.length<2||b.length<5?(dialog.info($.t("valid.msg.3")),!1):($.post("/message/saveCrmMessage",{messageTo:$("#sendto").val(),subject:a,content:b},function(a){var b=['<p><div class="msg-plan"></div></p><p data-i18n="[append]valid.msg.5"><br/></p>'],c={};c[$.t("valid.msg.4")]=function(){dialog.close()},resultHandle(a,function(){dialog.custom($.t("valid.msg.6"),b.join(""),c),$(".ui-dialog").i18n()}),$("#inbox .mcj_g").html(""),$(".mc-content")[0].reset()}),!1):(dialog.info($.t("valid.msg.2")),!1)})}